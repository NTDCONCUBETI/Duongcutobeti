getgenv().autoDigsiteConfig = {
    OPTIMIZE_GAME = flase, -- Set to true to optimize the game by removing unnecessary parts
    DIGSITE_RESET_DELAY = 10, -- Amount of time in seconds to wait before starting the script back up after the digsite resets
    LOAD_DELAY = 5,
    CHEST_BREAK_DELAY = 0.5, -- Amount of time in seconds to wait before breaking a chest
    DIG_DEPTH = 10,
    UNBROKEN_BLOCK_THRESHOLD = 100
}


local digsiteReset = false

local positions = {
[1] = Vector3.new(16, 1, 2),
[2] = Vector3.new(16, 1, 5),
[3] = Vector3.new(16, 1, 8),
[4] = Vector3.new(16,1,11),
[5] = Vector3.new(16, 1, 14),
[6] = Vector3.new(14, 1, 1),
[7] = Vector3.new(14, 1, 3),
[8] = Vector3.new(14, 1, 4),
[9] = Vector3.new(14, 1, 6),
[10] = Vector3.new(14, 1, 7),
[11] = Vector3.new(14, 1, 9),
[12] = Vector3.new(14, 1, 10),
[13] = Vector3.new(14, 1, 12),
[14] = Vector3.new(14, 1, 13),
[15] = Vector3.new(14, 1, 15),
[16] = Vector3.new(12, 1, 2),
[17] = Vector3.new(12, 1, 5),
[18] = Vector3.new(12, 1, 8),
[19] = Vector3.new(12, 1, 11),
[20] = Vector3.new(12, 1, 14),
[21] = Vector3.new(12, 1, 16),
[22] = Vector3.new(10, 1, 1),
[23] = Vector3.new(10, 1, 3),
[24] = Vector3.new(10, 1, 4),
[25] = Vector3.new(10, 1, 6),
[26] = Vector3.new(10, 1, 7),
[27] = Vector3.new(10, 1, 9),
[28] = Vector3.new(10, 1, 10),
[29] = Vector3.new(10, 1, 12),
[30] = Vector3.new(10, 1, 13),
[31] = Vector3.new(10, 1, 15),
[32] = Vector3.new(8, 1, 2),
[33] = Vector3.new(8, 1, 5),
[34] = Vector3.new(8, 1, 8),
[35] = Vector3.new(8, 1, 11),
[36] = Vector3.new(8, 1, 14),
[37] = Vector3.new(8, 1, 16),
[38] = Vector3.new(6, 1, 1),
[39] = Vector3.new(6, 1, 3),
[40] = Vector3.new(6, 1, 4),
[41] = Vector3.new(6, 1, 6),
[42] = Vector3.new(6, 1, 7),
[43] = Vector3.new(6, 1, 9),
[44] = Vector3.new(6, 1, 10),
[45] = Vector3.new(6, 1, 12),
[46] = Vector3.new(6, 1, 13),
[47] = Vector3.new(6, 1, 15),
[48] = Vector3.new(4, 1, 2),
[49] = Vector3.new(4, 1, 5),
[50] = Vector3.new(4, 1, 8),
[51] = Vector3.new(4, 1, 11),
[52] = Vector3.new(4, 1, 14),
[53] = Vector3.new(4, 1, 16),
[54] = Vector3.new(2, 1, 1),
[55] = Vector3.new(2, 1, 3),
[56] = Vector3.new(2, 1, 4),
[57] = Vector3.new(2, 1, 6),
[58] = Vector3.new(2, 1, 7),
[59] = Vector3.new(2, 1, 9),
[60] = Vector3.new(2, 1, 10),
[61] = Vector3.new(2, 1, 12),
[62] = Vector3.new(2, 1, 13),
[63] = Vector3.new(2, 1, 15),
}

local function checkForChests()
    for _, v in pairs(game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite.Important.ActiveChests:GetChildren()) do
        if v:IsA("Model") then
            pcall(function()
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = v.Top.CFrame
                task.wait(getgenv().autoDigsiteConfig.CHEST_BREAK_DELAY)
                game:GetService("ReplicatedStorage").Network:WaitForChild("Instancing_FireCustomFromClient"):FireServer("AdvancedDigsite", "DigChest", v:GetAttribute('Coord'))
                v:Destroy()
                task.wait()
            end)
        end
    end
end



local function beginCycle()
    for curPos, _ in positions do
        for _, v in pairs(game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite.Important.ActiveBlocks:GetChildren()) do
            if v:IsA("Part") then
                if (v:GetAttribute("Coord") - positions[curPos]).Magnitude == 0 then
                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = v.CFrame + Vector3.new(0, 3, 0)

                    local counter = 0
                    local function digBlock(depth)

                        if counter < getgenv().autoDigsiteConfig.UNBROKEN_BLOCK_THRESHOLD then

                            local block
                            for _, v in pairs(game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite.Important.ActiveBlocks:GetChildren()) do
                                if v:IsA("BasePart") then
                                    if (v:GetAttribute("Coord") - (positions[curPos] + Vector3.new(0, depth, 0))).Magnitude == 0 then
                                        block = v
                                    end
                                end
                            end

                            if block then
                                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = block.CFrame + Vector3.new(0, 3, 0)
                                game:GetService("ReplicatedStorage").Network:WaitForChild("Instancing_FireCustomFromClient"):FireServer("AdvancedDigsite", "DigBlock", block:GetAttribute('Coord'))
                                task.wait()
                                counter = counter + 1
                                digBlock(depth)
                            end

                        else
                            counter = 0
                        end
                    end


                    for i = 0, getgenv().autoDigsiteConfig.DIG_DEPTH do
                        checkForChests()
                        digBlock(i)
                        task.wait()
                    end
                end
            end
        end
    end
    print("Finished Cycle... Digging until reset")

    while not digsiteReset do
        for _, v in pairs(game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite.Important.ActiveBlocks:GetChildren()) do
            if v:IsA("Part") then
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = v.CFrame + Vector3.new(0, 3, 0)

                local counter = 0
                local function digBlock()

                    if counter < getgenv().autoDigsiteConfig.UNBROKEN_BLOCK_THRESHOLD then

                        local block
                        for _, v2 in pairs(game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite.Important.ActiveBlocks:GetChildren()) do
                            if v2:IsA("BasePart") then
                                if v2 == v then
                                    block = v2
                                end
                            end
                        end

                        if block then
                            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = block.CFrame + Vector3.new(0, 3, 0)
                            game:GetService("ReplicatedStorage").Network:WaitForChild("Instancing_FireCustomFromClient"):FireServer("AdvancedDigsite", "DigBlock", block:GetAttribute('Coord'))
                            task.wait()
                            counter = counter + 1
                            digBlock()
                        end

                    else
                        counter = 0
                    end
                end

                checkForChests()
                digBlock()
                task.wait()
            end
        end
    end
    digsiteReset = false
end


if getgenv().autoDigsiteConfig.OPTIMIZE_GAME then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/fdvll/pet-simulator-99/main/cpuReducer.lua"))()
    task.wait(10)
    for _, v in pairs(game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite:GetChildren()) do
        pcall(function()
            if v.Name == "Ground" then
                v.Transparency = 1
            elseif string.find(v.Name, "rock") or string.find(v.Name, "Sign") then
                v:Destroy()
            elseif v.Name == "Important" then
                v:FindFirstChild("Merchant"):Destroy()
            elseif v.Name == "Map" then
                for _, v2 in pairs(v:GetChildren()) do
                    if v2:IsA("Model") or string.find(v2.Name, "Mesh") or string.find(v2.Name, "G7") then
                        v2:Destroy()
                    end
                end
            end
        end)
    end
end



task.spawn(function()
    while #game:GetService("Workspace").__THINGS.__INSTANCE_CONTAINER.Active.AdvancedDigsite.Important.ActiveBlocks:GetChildren() > 336 do -- MAX WILL BE 336

        task.wait()
    end
    digsiteReset = true
    print("Digsite Reset")
    task.wait(getgenv().autoDigsiteConfig.DIGSITE_RESET_DELAY)
    beginCycle()
end)

require(game:GetService("ReplicatedStorage").Library.Client.WorldFX).AnimateChest = function(...)
    return
end

for _, lootbag in pairs(game:GetService("Workspace").__THINGS:FindFirstChild("Lootbags"):GetChildren()) do
    if lootbag then
        game:GetService("ReplicatedStorage"):WaitForChild("Network"):WaitForChild("Lootbags_Claim"):FireServer(unpack( { [1] = { [1] = lootbag.Name, }, } ))
        lootbag:Destroy()
        task.wait()
    end
end

game:GetService("Workspace").__THINGS:FindFirstChild("Lootbags").ChildAdded:Connect(function(lootbag)
    task.wait()
    if lootbag then
        game:GetService("ReplicatedStorage"):WaitForChild("Network"):WaitForChild("Lootbags_Claim"):FireServer(unpack( { [1] = { [1] = lootbag.Name, }, } ))
        lootbag:Destroy()
    end
end)

game:GetService("Workspace").__THINGS:FindFirstChild("Orbs").ChildAdded:Connect(function(orb)
    task.wait()
    if orb then
        game:GetService("ReplicatedStorage").Network:FindFirstChild("Orbs: Collect"):FireServer(unpack( { [1] = { [1] = tonumber(orb.Name), }, } ))
        orb:Destroy()
    end
end)

beginCycle()
